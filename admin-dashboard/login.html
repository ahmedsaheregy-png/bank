<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† - SAWYAN BANK</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Tajawal:wght@400;500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../shared/css/variables.css">
    <link rel="stylesheet" href="../shared/css/logo.css">
    <link rel="stylesheet" href="../member-dashboard/css/auth.css">
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="auth-container">
        <div class="auth-card">
            <div id="logoContainer" class="logo-section"></div>

            <h1>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h1>
            <p class="subtitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</p>

            <div class="form-note" style="margin-bottom: 20px;">
                <p><strong>ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:</strong></p>
                <p>Email: <code>admin@sawyan.com</code></p>
                <p>Password: <code>123456</code></p>
            </div>

            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="email" required class="form-control" value="admin@sawyan.com"
                        placeholder="admin@sawyan.com">
                </div>

                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="password" required class="form-control" value="123456"
                        placeholder="123456">
                </div>

                <button type="submit" class="btn btn-primary btn-block">Ø¯Ø®ÙˆÙ„</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../shared/config/supabase.js"></script>
    <script src="../shared/components/logo.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.SAWYAN && window.SAWYAN.Logo) {
                document.getElementById('logoContainer').innerHTML = window.SAWYAN.Logo.full();
            }

            const loadingOverlay = document.getElementById('loadingOverlay');

            document.getElementById('loginForm').addEventListener('submit', async function (e) {
                e.preventDefault();

                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;

                // Ø¥Ø¸Ù‡Ø§Ø± loading
                loadingOverlay.classList.add('active');

                try {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ Ø¬Ø¯ÙˆÙ„ admins
                    const { data: admin, error: queryError } = await window.SAWYAN.supabase
                        .from('admins')
                        .select('*')
                        .eq('email', email)
                        .single();

                    if (queryError || !admin) {
                        throw new Error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    }

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                    if (admin.password_hash !== password) {
                        throw new Error('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                    }

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
                    if (!admin.is_active) {
                        throw new Error('Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙØ¹Ù„');
                    }

                    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ localStorage
                    localStorage.setItem('sawyan_admin', JSON.stringify(admin));
                    localStorage.setItem('sawyan_user_type', 'admin');

                    // Ø¥Ø®ÙØ§Ø¡ loading
                    loadingOverlay.classList.remove('active');

                    // Ù†Ø¬Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    window.location.href = 'dashboard.html';

                } catch (error) {
                    // Ø¥Ø®ÙØ§Ø¡ loading
                    loadingOverlay.classList.remove('active');

                    console.error('Login Error:', error);
                    alert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:\n\n' + error.message + '\n\nØªØ£ÙƒØ¯ Ù…Ù†:\nâœ“ ØªÙ†ÙÙŠØ° schema.sql ÙÙŠ Supabase');
                }
            });
        });
    </script>
</body>

</html>